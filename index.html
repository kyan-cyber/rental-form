<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>カードガチャ</title>
  <style>
    body {
      background: linear-gradient(to bottom right, #000, #333);
      color: white;
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }

    #gachaButton {
      padding: 20px 40px;
      font-size: 24px;
      background-color: gold;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 0 20px gold;
    }

    #cardImage {
      display: none;
      max-width: 90%;
      height: auto;
      margin-top: 20px;
      border-radius: 12px;
    }

    #animationContainer {
      margin: 30px auto;
      width: 300px;
      height: 300px;
      position: relative;
    }

    .ball {
      width: 100px;
      height: 100px;
      background-color: red;
      border-radius: 50%;
      position: absolute;
      animation: roll 3s ease-in-out;
    }

    @keyframes roll {
      0% { left: -150px; top: 100px; transform: rotate(0deg); }
      50% { left: 150px; top: 60px; transform: rotate(360deg); }
      100% { left: 100px; top: 100px; transform: rotate(720deg); }
    }

    .shake {
      animation: shake 0.6s infinite alternate;
    }

    .zoom {
      animation: zoom 1.2s ease-out;
    }

    @keyframes shake {
      from { transform: rotate(-5deg); }
      to { transform: rotate(5deg); }
    }

    @keyframes zoom {
      from { transform: scale(0.2); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body>
  <h1>カードガチャ</h1>
  <button id="gachaButton">ガチャを引く！</button>
  <img id="cardImage" src="" alt="カード画像">
  <div id="animationContainer"></div>

  <script>
    const rarities = {
      N: { rate: 50, count: 25 },
      R: { rate: 25, count: 10 },
      SR: { rate: 12, count: 7 },
      UR: { rate: 8, count: 5 },
      SE: { rate: 5, count: 4 }
    };

    let firstPull = true;

    function getRandomCard() {
      const rand = Math.random() * 100;
      let total = 0;
      for (let rarity in rarities) {
        total += rarities[rarity].rate;
        if (rand <= total) {
          const index = Math.floor(Math.random() * rarities[rarity].count) + 1;
          return { rarity, image: `images/${rarity}${index}.png` };
        }
      }
    }

    function pullGacha() {
      const button = document.getElementById("gachaButton");
      const animationContainer = document.getElementById("animationContainer");
      const cardImage = document.getElementById("cardImage");

      button.disabled = true;
      cardImage.style.display = "none";
      cardImage.className = ""; // クラスを初期化

      if (firstPull) {
        animationContainer.innerHTML = "<div class='ball'></div>";
        setTimeout(() => {
          showCard();
          animationContainer.innerHTML = "";
          firstPull = false;
        }, 3000);
      } else {
        showCard();
      }

      function showCard() {
        const card = getRandomCard();
        cardImage.src = card.image;
        if (card.rarity === "UR" || card.rarity === "SE") {
          cardImage.classList.add("zoom");
        } else {
          cardImage.classList.add("shake");
        }
        cardImage.style.display = "block";
        button.disabled = false;
      }
    }

    document.getElementById("gachaButton").addEventListener("click", pullGacha);
  </script>
</body>
</html>
