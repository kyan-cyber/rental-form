async function main() {
  try {
    await liff.init({ liffId });

    if (!liff.isLoggedIn()) {
      liff.login();
      return;
    }

    const profile = await liff.getProfile();
    const userId = profile.userId;
    document.getElementById("userId").value = userId;

    const urlParams = new URLSearchParams(window.location.search);
    const itemName = urlParams.get("item") || "";
    document.getElementById("item").value = itemName;

    document.getElementById("rentalForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      console.log("フォーム送信イベント発火");
      const data = {
        userId: userId,
        item: itemName,
        action: "貸出"
      };

      try {
        console.log("fetch前のデータ:", data);
        const response = await fetch("https://script.google.com/macros/s/AKfycbzShpUoHT-Uupu-8YeGsXZIPxkwtmWqad6v66f3Oo17TfWDiurMSdSoo3E2ZaLIDs63/exec", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });

        console.log("fetch後、レスポンスステータス:", response.status);

        if (response.ok) {
          document.getElementById("rentalForm").style.display = "none";
          const status = document.getElementById("status");
          status.textContent = "貸出OK";
          status.style.display = "block";
        } else {
          alert("送信に失敗しました。");
        }
      } catch (err) {
        console.error("fetchエラー:", err);
        alert("エラー: " + err);
      }
    });  // ← ここでaddEventListenerの関数を閉じる

  } catch (error) {
    alert("LIFF初期化失敗：" + error);
  }
}

main();
